<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      lang="en">

<th:block>
    <div th:replace="fragments/head.html :: head"></div>
</th:block>

<body>
<div class="container-fluid">
    <th:block>
        <div th:replace="fragments/header.html :: header"></div>
    </th:block>
    <main>
        <p>
            <a th:href="@{/register}">
                <img border="0" alt="indexImg"
                     src="https://res.cloudinary.com/mgpavlov/image/upload/v1554130701/frontPage.jpg"
                     style="width: 100%; height: 100%">
            </a>
        </p>
        <div>
            <div class="row d-flex justify-content-between">
                <div class="data col-md">
                    <h1 class="text-center font-weight-bold">Products</h1>
                </div>
                <div class="print-container container-fluid">
                    <div class="row mb-4 d-flex justify-content-start products-data"></div>
                </div>
            </div>
        </div>
    </main>
    <th:block>
        <div th:replace="fragments/footer.html :: footer"></div>
    </th:block>
</div>
<script>
    function formatProduct(product) {
        return '<div class="product col-md-2 mt-2 bg-re rounded ml-4 mr-4 mb-5">'
            + '<div class="text-center mt-3">'
            + `<a href="/products/details/${product.id}"><img src="${product.imageUrl}" class="product-image-home img-thumbnail px-auto" alt="Image not loaded..."/></a>`
            + '</div>'
            + `<h5 class="text-center font-weight-bold mt-3">Name: ${product.name}</h5>`
            + `<h5 class="text-center font-weight-bold">Price: ${product.price.toFixed(2)}</h5>`
            + '</div>'
    }

    fetch('/products/fetch/sale')
        .then((response) => response.json())
        .then((json) => {
            $('.products-data').empty();

            if (json.length === 0) {
                $('.products-data').append(`<h1 class="text-center font-weight-bold">There are no products in the ${category} category.</h1>`)
            } else {
                let productsCount = json.length;
                if (productsCount > 5){
                    productsCount = 5;
                }

                for (let i = 0; i < productsCount; i++) {
                    $('.products-data').append(formatProduct(json[i]));
                }
            }
        })
        .catch((err) => console.log(err));
</script>
</body>
</html>